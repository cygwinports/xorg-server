Allow the default log location to be configurable (e.g. /var/log),
and use separate logs for each display instance (e.g. XWin.0.log).

FIXME: g_pszLogFile should be (const char*) per os/log.c:LogInit().

---
 configure.ac             |    1 +
 hw/xwin/InitOutput.c     |   14 +++++++-------
 hw/xwin/winerror.c       |    7 +++++++
 hw/xwin/winglobals.c     |    2 +-
 include/xwin-config.h.in |    1 -
 5 files changed, 16 insertions(+), 9 deletions(-)

--- origsrc/xorg-server-1.5.3/configure.ac	2008-11-12 21:54:18.257937400 -0600
+++ src/xorg-server-1.5.3/configure.ac	2008-11-12 22:13:01.507937400 -0600
@@ -1659,6 +1659,7 @@
 AC_MSG_RESULT([$XWIN])
 
 if test "x$XWIN" = xyes; then
+	AC_DEFINE_DIR(DEFAULT_LOGDIR, logdir, [Default log location])
 	AC_DEFINE_UNQUOTED(XORG_VERSION_CURRENT, [$VENDOR_RELEASE], [Current Xorg version])
 	AC_DEFINE_UNQUOTED(__VENDORDWEBSUPPORT__, ["$VENDOR_WEB"], [Vendor web address for support])
 	AC_CHECK_TOOL(WINDRES, windres)
--- origsrc/xorg-server-1.5.3/hw/xwin/InitOutput.c	2008-11-12 21:54:13.945437400 -0600
+++ src/xorg-server-1.5.3/hw/xwin/InitOutput.c	2008-11-12 22:31:23.097847400 -0600
@@ -243,7 +243,7 @@
 #endif
 
   if (!g_fLogInited) {
-    LogInit (g_pszLogFile, NULL);
+    g_pszLogFile = LogInit (g_pszLogFile, NULL);
     g_fLogInited = TRUE;
   }  
   LogClose ();
@@ -715,7 +712,7 @@
      * avoid the second call 
      */  
     g_fLogInited = TRUE;
-    LogInit (g_pszLogFile, NULL);
+    g_pszLogFile = LogInit (g_pszLogFile, NULL);
   } 
   LogSetParameter (XLOG_FLUSH, 1);
   LogSetParameter (XLOG_VERBOSITY, g_iLogVerbose);
@@ -888,7 +888,7 @@
 #endif
 
   ErrorF ("-logfile filename\n"
-	  "\tWrite logmessages to <filename> instead of /tmp/Xwin.log.\n");
+	  "\tWrite logmessages to <filename>.\n");
 
   ErrorF ("-logverbose verbosity\n"
 	  "\tSet the verbosity of logmessages. [NOTE: Only a few messages\n"
@@ -918,7 +915,7 @@
 
   /* Log file will not be opened for UseMsg unless we open it now */
   if (!g_fLogInited) {
-    LogInit (g_pszLogFile, NULL);
+    g_pszLogFile = LogInit (g_pszLogFile, NULL);
     g_fLogInited = TRUE;
   }  
   LogClose ();
@@ -926,9 +926,9 @@
   /* Notify user where UseMsg text can be found.*/
   if (!g_fNoHelpMessageBox)
     winMessageBoxF ("The " PROJECT_NAME " help text has been printed to "
-		  "/tmp/XWin.log.\n"
-		  "Please open /tmp/XWin.log to read the help text.\n",
-		  MB_ICONINFORMATION);
+		  "%s.\n"
+		  "Please open %s to read the help text.\n",
+		  MB_ICONINFORMATION, g_pszLogFile, g_pszLogFile);
 }
 
 /* ddxInitGlobals - called by |InitGlobals| from os/util.c */
--- origsrc/xorg-server-1.5.3/hw/xwin/winglobals.c	2008-11-18 00:47:16.495683100 -0600
+++ src/xorg-server-1.5.3/hw/xwin/winglobals.c	2008-11-18 00:47:24.730058100 -0600
@@ -64,7 +64,7 @@
 HICON		g_hIconX = NULL;
 HICON		g_hSmallIconX = NULL;
 #ifndef RELOCATE_PROJECTROOT
-char *		g_pszLogFile = "/tmp/XWin.log";
+char *		g_pszLogFile = DEFAULT_LOGDIR "/XWin.%s.log";
 #else
 char *		g_pszLogFile = "XWin.log";
 Bool		g_fLogFileChanged = FALSE;
--- origsrc/xorg-server-1.5.3/hw/xwin/winerror.c	2008-11-19 23:57:42.368957500 -0600
+++ src/xorg-server-1.5.3/hw/xwin/winerror.c	2008-11-20 03:48:25.621350500 -0600
@@ -42,6 +42,7 @@
 extern char *		g_pszCommandLine;
 extern char *		g_pszLogFile;
 extern Bool		g_fSilentFatalError;
+extern Bool		g_fLogInited;
 
 
 #ifdef DDXOSVERRORF
@@ -86,6 +87,12 @@
   if (g_fSilentFatalError)
     return;
 
+  if (!g_fLogInited) {
+    g_fLogInited = TRUE;
+    g_pszLogFile = LogInit (g_pszLogFile, NULL);
+  }
+  LogClose ();
+
   winMessageBoxF (
           "A fatal error has occurred and " PROJECT_NAME " will now exit.\n" \
 		  "Please open %s for more information.\n",
--- origsrc/xorg-server-1.5.3/include/xwin-config.h.in	2008-11-12 21:54:18.273562400 -0600
+++ src/xorg-server-1.5.3/include/xwin-config.h.in	2008-11-12 22:15:07.195437400 -0600
@@ -24,4 +24,7 @@
 #undef NEED_SNPRINTF
 
 /* Vendor web address for support */
-#undef __VENDORDWEBSUPPORT__
\ No newline at end of file
+#undef __VENDORDWEBSUPPORT__
+
+/* Default log location */
+#undef DEFAULT_LOGDIR
